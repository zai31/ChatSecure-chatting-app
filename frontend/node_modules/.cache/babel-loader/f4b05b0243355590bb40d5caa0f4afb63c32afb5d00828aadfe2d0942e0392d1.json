{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nimport isEqual from 'react-fast-compare';\n/**\n * Create an AuthProvider component to wrap a React app with, it will take care of common AuthClient\n * lifecycle handling (such as initialization and token refresh).\n *\n * @param AuthContext the Auth context to be used by the created AuthProvider\n *\n * @returns the AuthProvider component\n */\nexport function createAuthProvider(AuthContext) {\n  var defaultInitOptions = {\n    onLoad: 'check-sso'\n  };\n  var initialState = {\n    initialized: false,\n    isAuthenticated: false,\n    isLoading: true\n  };\n  return /** @class */function (_super) {\n    __extends(KeycloakProvider, _super);\n    function KeycloakProvider() {\n      var _this = _super !== null && _super.apply(this, arguments) || this;\n      _this.state = __assign({}, initialState);\n      _this.onError = function (event) {\n        return function (error) {\n          var onEvent = _this.props.onEvent;\n          // Notify Events listener\n          onEvent && onEvent(event, error);\n        };\n      };\n      _this.updateState = function (event) {\n        return function () {\n          var _a = _this.props,\n            authClient = _a.authClient,\n            onEvent = _a.onEvent,\n            onTokens = _a.onTokens,\n            isLoadingCheck = _a.isLoadingCheck;\n          var _b = _this.state,\n            prevInitialized = _b.initialized,\n            prevAuthenticated = _b.isAuthenticated,\n            prevLoading = _b.isLoading;\n          // Notify Events listener\n          onEvent && onEvent(event);\n          // Check Loading state\n          var isLoading = isLoadingCheck ? isLoadingCheck(authClient) : false;\n          // Check if user is authenticated\n          var isAuthenticated = isUserAuthenticated(authClient);\n          // Avoid double-refresh if state hasn't changed\n          if (!prevInitialized || isAuthenticated !== prevAuthenticated || isLoading !== prevLoading) {\n            _this.setState({\n              initialized: true,\n              isAuthenticated: isAuthenticated,\n              isLoading: isLoading\n            });\n          }\n          // Notify token listener, if any\n          var idToken = authClient.idToken,\n            refreshToken = authClient.refreshToken,\n            token = authClient.token;\n          onTokens && onTokens({\n            idToken: idToken,\n            refreshToken: refreshToken,\n            token: token\n          });\n        };\n      };\n      _this.refreshToken = function (event) {\n        return function () {\n          var _a = _this.props,\n            autoRefreshToken = _a.autoRefreshToken,\n            authClient = _a.authClient,\n            onEvent = _a.onEvent;\n          // Notify Events listener\n          onEvent && onEvent(event);\n          if (autoRefreshToken !== false) {\n            // Refresh Keycloak token\n            authClient.updateToken(5);\n          }\n        };\n      };\n      return _this;\n    }\n    KeycloakProvider.prototype.componentDidMount = function () {\n      this.init();\n    };\n    KeycloakProvider.prototype.componentDidUpdate = function (_a) {\n      var prevAuthClient = _a.authClient,\n        prevInitOptions = _a.initOptions;\n      var _b = this.props,\n        initOptions = _b.initOptions,\n        authClient = _b.authClient;\n      if (authClient !== prevAuthClient || !isEqual(initOptions, prevInitOptions)) {\n        // De-init previous AuthClient instance\n        prevAuthClient.onReady = undefined;\n        prevAuthClient.onAuthSuccess = undefined;\n        prevAuthClient.onAuthError = undefined;\n        prevAuthClient.onAuthRefreshSuccess = undefined;\n        prevAuthClient.onAuthRefreshError = undefined;\n        prevAuthClient.onAuthLogout = undefined;\n        prevAuthClient.onTokenExpired = undefined;\n        // Reset state\n        this.setState(__assign({}, initialState));\n        // Init new AuthClient instance\n        this.init();\n      }\n    };\n    KeycloakProvider.prototype.init = function () {\n      var _a = this.props,\n        initOptions = _a.initOptions,\n        authClient = _a.authClient;\n      // Attach Keycloak listeners\n      authClient.onReady = this.updateState('onReady');\n      authClient.onAuthSuccess = this.updateState('onAuthSuccess');\n      authClient.onAuthError = this.onError('onAuthError');\n      authClient.onAuthRefreshSuccess = this.updateState('onAuthRefreshSuccess');\n      authClient.onAuthRefreshError = this.onError('onAuthRefreshError');\n      authClient.onAuthLogout = this.updateState('onAuthLogout');\n      authClient.onTokenExpired = this.refreshToken('onTokenExpired');\n      authClient.init(__assign(__assign({}, defaultInitOptions), initOptions)).catch(this.onError('onInitError'));\n    };\n    KeycloakProvider.prototype.render = function () {\n      var _a = this.props,\n        children = _a.children,\n        authClient = _a.authClient,\n        LoadingComponent = _a.LoadingComponent;\n      var _b = this.state,\n        initialized = _b.initialized,\n        isLoading = _b.isLoading;\n      if (!!LoadingComponent && (!initialized || isLoading)) {\n        return LoadingComponent;\n      }\n      return React.createElement(AuthContext.Provider, {\n        value: {\n          initialized: initialized,\n          authClient: authClient\n        }\n      }, children);\n    };\n    return KeycloakProvider;\n  }(React.PureComponent);\n}\nfunction isUserAuthenticated(authClient) {\n  return !!authClient.idToken && !!authClient.token;\n}\nexport default createAuthProvider;","map":{"version":3,"names":["React","isEqual","createAuthProvider","AuthContext","defaultInitOptions","onLoad","initialState","initialized","isAuthenticated","isLoading","_super","__extends","KeycloakProvider","_this","apply","arguments","state","__assign","onError","event","error","onEvent","props","updateState","_a","authClient","onTokens","isLoadingCheck","_b","prevInitialized","prevAuthenticated","prevLoading","isUserAuthenticated","setState","idToken","refreshToken","token","autoRefreshToken","updateToken","prototype","componentDidMount","init","componentDidUpdate","prevAuthClient","prevInitOptions","initOptions","onReady","undefined","onAuthSuccess","onAuthError","onAuthRefreshSuccess","onAuthRefreshError","onAuthLogout","onTokenExpired","catch","render","children","LoadingComponent","createElement","Provider","value","PureComponent"],"sources":["@react-keycloak/core/provider.tsx"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,KAAKA,KAAK,MAAM,OAAO;AAC9B,OAAOC,OAAO,MAAM,oBAAoB;AAqExC;;;;;;;;AAQA,OAAM,SAAUC,kBAAkBA,CAChCC,WAAgD;EAEhD,IAAMC,kBAAkB,GAA0B;IAChDC,MAAM,EAAE;GACT;EAED,IAAMC,YAAY,GAAsB;IACtCC,WAAW,EAAE,KAAK;IAClBC,eAAe,EAAE,KAAK;IACtBC,SAAS,EAAE;GACZ;EAED,8BAAAC,MAAA;IAAsCC,SAAA,CAAAC,gBAAA,EAAAF,MAAA;IAA/B,SAAAE,iBAAA;MAAA,IAAAC,KAAA,GAAAH,MAAA,aAAAA,MAAA,CAAAI,KAAA,OAAAC,SAAA;MAILF,KAAA,CAAAG,KAAK,GAAAC,QAAA,KACAX,YAAY;MAiDjBO,KAAA,CAAAK,OAAO,GAAG,UAACC,KAAsB;QAAK,iBAACC,KAAuB;UACpD,IAAAC,OAAO,GAAKR,KAAI,CAACS,KAAK,CAAAD,OAAf;UACf;UACAA,OAAO,IAAIA,OAAO,CAACF,KAAK,EAAEC,KAAK,CAAC;QAClC,CAAC;MAJqC,CAIrC;MAEDP,KAAA,CAAAU,WAAW,GAAG,UAACJ,KAAsB;QAAK;UAClC,IAAAK,EAAA,GAAoDX,KAAI,CAACS,KAAK;YAA5DG,UAAU,GAAAD,EAAA,CAAAC,UAAA;YAAEJ,OAAO,GAAAG,EAAA,CAAAH,OAAA;YAAEK,QAAQ,GAAAF,EAAA,CAAAE,QAAA;YAAEC,cAAc,GAAAH,EAAA,CAAAG,cAAe;UAC9D,IAAAC,EAAA,GAIFf,KAAI,CAACG,KAAK;YAHCa,eAAe,GAAAD,EAAA,CAAArB,WAAA;YACXuB,iBAAiB,GAAAF,EAAA,CAAApB,eAAA;YACvBuB,WAAW,GAAAH,EAAA,CAAAnB,SACV;UAEd;UACAY,OAAO,IAAIA,OAAO,CAACF,KAAK,CAAC;UAEzB;UACA,IAAMV,SAAS,GAAGkB,cAAc,GAAGA,cAAc,CAACF,UAAU,CAAC,GAAG,KAAK;UAErE;UACA,IAAMjB,eAAe,GAAGwB,mBAAmB,CAACP,UAAU,CAAC;UAEvD;UACA,IACE,CAACI,eAAe,IAChBrB,eAAe,KAAKsB,iBAAiB,IACrCrB,SAAS,KAAKsB,WAAW,EACzB;YACAlB,KAAI,CAACoB,QAAQ,CAAC;cACZ1B,WAAW,EAAE,IAAI;cACjBC,eAAe,EAAAA,eAAA;cACfC,SAAS,EAAAA;aACV,CAAC;;UAGJ;UACQ,IAAAyB,OAAO,GAA0BT,UAAU,CAAAS,OAApC;YAAEC,YAAY,GAAYV,UAAU,CAAAU,YAAtB;YAAEC,KAAK,GAAKX,UAAU,CAAAW,KAAf;UACpCV,QAAQ,IACNA,QAAQ,CAAC;YACPQ,OAAO,EAAAA,OAAA;YACPC,YAAY,EAAAA,YAAA;YACZC,KAAK,EAAAA;WACN,CAAC;QACN,CAAC;MAtCyC,CAsCzC;MAEDvB,KAAA,CAAAsB,YAAY,GAAG,UAAChB,KAAsB;QAAK;UACnC,IAAAK,EAAA,GAA4CX,KAAI,CAACS,KAAK;YAApDe,gBAAgB,GAAAb,EAAA,CAAAa,gBAAA;YAAEZ,UAAU,GAAAD,EAAA,CAAAC,UAAA;YAAEJ,OAAO,GAAAG,EAAA,CAAAH,OAAe;UAC5D;UACAA,OAAO,IAAIA,OAAO,CAACF,KAAK,CAAC;UAEzB,IAAIkB,gBAAgB,KAAK,KAAK,EAAE;YAC9B;YACAZ,UAAU,CAACa,WAAW,CAAC,CAAC,CAAC;;QAE7B,CAAC;MAT0C,CAS1C;;IAgBH;IArHE1B,gBAAA,CAAA2B,SAAA,CAAAC,iBAAiB,GAAjB;MACE,IAAI,CAACC,IAAI,EAAE;IACb,CAAC;IAED7B,gBAAA,CAAA2B,SAAA,CAAAG,kBAAkB,GAAlB,UAAmBlB,EAGI;UAFTmB,cAAc,GAAAnB,EAAA,CAAAC,UAAA;QACbmB,eAAe,GAAApB,EAAA,CAAAqB,WAAA;MAEtB,IAAAjB,EAAA,GAA8B,IAAI,CAACN,KAAK;QAAtCuB,WAAW,GAAAjB,EAAA,CAAAiB,WAAA;QAAEpB,UAAU,GAAAG,EAAA,CAAAH,UAAe;MAC9C,IACEA,UAAU,KAAKkB,cAAc,IAC7B,CAAC1C,OAAO,CAAC4C,WAAW,EAAED,eAAe,CAAC,EACtC;QACA;QACAD,cAAc,CAACG,OAAO,GAAGC,SAAS;QAClCJ,cAAc,CAACK,aAAa,GAAGD,SAAS;QACxCJ,cAAc,CAACM,WAAW,GAAGF,SAAS;QACtCJ,cAAc,CAACO,oBAAoB,GAAGH,SAAS;QAC/CJ,cAAc,CAACQ,kBAAkB,GAAGJ,SAAS;QAC7CJ,cAAc,CAACS,YAAY,GAAGL,SAAS;QACvCJ,cAAc,CAACU,cAAc,GAAGN,SAAS;QAEzC;QACA,IAAI,CAACd,QAAQ,CAAAhB,QAAA,KAAMX,YAAY,EAAG;QAClC;QACA,IAAI,CAACmC,IAAI,EAAE;;IAEf,CAAC;IAED7B,gBAAA,CAAA2B,SAAA,CAAAE,IAAI,GAAJ;MACQ,IAAAjB,EAAA,GAA8B,IAAI,CAACF,KAAK;QAAtCuB,WAAW,GAAArB,EAAA,CAAAqB,WAAA;QAAEpB,UAAU,GAAAD,EAAA,CAAAC,UAAe;MAE9C;MACAA,UAAU,CAACqB,OAAO,GAAG,IAAI,CAACvB,WAAW,CAAC,SAAS,CAAC;MAChDE,UAAU,CAACuB,aAAa,GAAG,IAAI,CAACzB,WAAW,CAAC,eAAe,CAAC;MAC5DE,UAAU,CAACwB,WAAW,GAAG,IAAI,CAAC/B,OAAO,CAAC,aAAa,CAAC;MACpDO,UAAU,CAACyB,oBAAoB,GAAG,IAAI,CAAC3B,WAAW,CAAC,sBAAsB,CAAC;MAC1EE,UAAU,CAAC0B,kBAAkB,GAAG,IAAI,CAACjC,OAAO,CAAC,oBAAoB,CAAC;MAClEO,UAAU,CAAC2B,YAAY,GAAG,IAAI,CAAC7B,WAAW,CAAC,cAAc,CAAC;MAC1DE,UAAU,CAAC4B,cAAc,GAAG,IAAI,CAAClB,YAAY,CAAC,gBAAgB,CAAC;MAE/DV,UAAU,CACPgB,IAAI,CAAAxB,QAAA,CAAAA,QAAA,KAAMb,kBAAkB,GAAKyC,WAAW,EAAG,CAC/CS,KAAK,CAAC,IAAI,CAACpC,OAAO,CAAC,aAAa,CAAC,CAAC;IACvC,CAAC;IA2DDN,gBAAA,CAAA2B,SAAA,CAAAgB,MAAM,GAAN;MACQ,IAAA/B,EAAA,GAA6C,IAAI,CAACF,KAAK;QAArDkC,QAAQ,GAAAhC,EAAA,CAAAgC,QAAA;QAAE/B,UAAU,GAAAD,EAAA,CAAAC,UAAA;QAAEgC,gBAAgB,GAAAjC,EAAA,CAAAiC,gBAAe;MACvD,IAAA7B,EAAA,GAA6B,IAAI,CAACZ,KAAK;QAArCT,WAAW,GAAAqB,EAAA,CAAArB,WAAA;QAAEE,SAAS,GAAAmB,EAAA,CAAAnB,SAAe;MAE7C,IAAI,CAAC,CAACgD,gBAAgB,KAAK,CAAClD,WAAW,IAAIE,SAAS,CAAC,EAAE;QACrD,OAAOgD,gBAAgB;;MAGzB,OACEzD,KAAA,CAAA0D,aAAA,CAACvD,WAAW,CAACwD,QAAQ;QAACC,KAAK,EAAE;UAAErD,WAAW,EAAAA,WAAA;UAAEkB,UAAU,EAAAA;QAAA;MAAE,GACrD+B,QAAQ,CACY;IAE3B,CAAC;IACH,OAAA5C,gBAAC;EAAD,CAAC,CA7HqCZ,KAAK,CAAC6D,aAAa;AA8H3D;AAEA,SAAS7B,mBAAmBA,CAACP,UAAsB;EACjD,OAAO,CAAC,CAACA,UAAU,CAACS,OAAO,IAAI,CAAC,CAACT,UAAU,CAACW,KAAK;AACnD;AAEA,eAAelC,kBAAkB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}